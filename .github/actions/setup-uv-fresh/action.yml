name: 'Setup UV Fresh'
description: 'Setup Python, UV, generate pyproject.toml, and install dependencies from scratch'
inputs:
  python-version:
    description: 'Python version to setup'
    required: true
  install-deps:
    description: 'Whether to install dependencies'
    required: false
    default: 'true'
  cache-key-suffix:
    description: 'Additional cache key suffix'
    required: false
    default: ''
runs:
  using: 'composite'
  steps:
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ inputs.python-version }}

    - name: Install UV
      uses: astral-sh/setup-uv@v6
      with:
        version: "0.9.6"
        enable-cache: true
        cache-dependency-glob: "pyproject.toml"
        cache-suffix: ${{ inputs.cache-key-suffix }}

    - name: Install system dependencies for Python 3.14
      if: inputs.python-version == '3.14'
      shell: bash
      run: |
        sudo apt-get update
        sudo apt-get install -y libxml2-dev libxslt1-dev

    - name: Generate pyproject.toml
      shell: bash
      run: make generate-pyproject

    - name: Upgrade pip to secure version
      shell: bash
      run: python -m pip install --upgrade pip>=25.3

    - name: Install dependencies
      if: inputs.install-deps == 'true'
      shell: bash
      run: make ci-install
