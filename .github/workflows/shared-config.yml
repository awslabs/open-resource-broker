name: Shared Configuration

on:
  workflow_call:
    outputs:
      python-versions:
        description: 'JSON array of Python versions'
        value: ${{ jobs.get-config.outputs.python-versions }}
      default-python-version:
        description: 'Default Python version'
        value: ${{ jobs.get-config.outputs.default-python-version }}
      container-registry:
        description: 'Container registry'
        value: ${{ jobs.get-config.outputs.container-registry }}
      container-image:
        description: 'Container image name'
        value: ${{ jobs.get-config.outputs.container-image }}
      package-version:
        description: 'Package version'
        value: ${{ jobs.get-config.outputs.package-version }}
      is-release:
        description: 'Whether this is a release build'
        value: ${{ jobs.get-config.outputs.is-release }}
      aws-region:
        description: 'AWS region for testing'
        value: ${{ jobs.get-config.outputs.aws-region }}
      aws-access-key:
        description: 'AWS access key for testing'
        value: ${{ jobs.get-config.outputs.aws-access-key }}
      aws-secret-key:
        description: 'AWS secret key for testing'
        value: ${{ jobs.get-config.outputs.aws-secret-key }}
      environment:
        description: 'Environment name'
        value: ${{ jobs.get-config.outputs.environment }}
      testing-flag:
        description: 'Testing flag'
        value: ${{ jobs.get-config.outputs.testing-flag }}

jobs:
  get-config:
    name: Get Configuration
    runs-on: ubuntu-latest
    permissions:
      contents: read
    outputs:
      python-versions: ${{ steps.config.outputs.python-versions }}
      default-python-version: ${{ steps.config.outputs.default-python-version }}
      container-registry: ${{ steps.config.outputs.container-registry }}
      container-image: ${{ steps.config.outputs.container-image }}
      package-version: ${{ steps.config.outputs.package-version }}
      is-release: ${{ steps.config.outputs.is-release }}
      aws-region: us-east-1
      aws-access-key: testing
      aws-secret-key: testing
      environment: testing
      testing-flag: "true"
    steps:
    - name: Checkout code
      uses: actions/checkout@v6.0.1

    - name: Setup cache
      uses: actions/cache@v5
      with:
        path: |
          ~/.cache/uv
          .venv
        key: config-${{ hashFiles('.project.yml', 'pyproject.toml') }}
        restore-keys: |
          config-

    - name: Get project configuration
      id: config
      uses: ./.github/actions/get-config
